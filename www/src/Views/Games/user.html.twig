{% extends 'Layouts/main.html.twig' %}

{% block content %}
<div id="app">
    <div class="sticky top-0 px-4 bg-neutral-900 p-3 z-50">
        <h1 class="text-xl mb-2"><strong>{{ game.name }}</strong></h1>
        <label class="font-bold inline-block py-2" for="searchbox">search</label><input type="text" id="searchbox" v-model="searchbox" class="rounded" /><br>
        <input type="radio" value="locked" id="listMode2" v-model="listMode" class="hidden mr-2 peer/a1" /><label for="listMode2" class="peer-checked/a1:text-sky-500 inline-block bg-neutral-500 peer-checked/a1:bg-sky-900 py-1 px-2 rounded mr-2">not unlocked</label>
        <input type="radio" value="achieved" id="listMode1" v-model="listMode" class="hidden mr-2 peer/a2" /><label for="listMode1" class="peer-checked/a2:text-sky-500 inline-block bg-neutral-500 peer-checked/a2:bg-sky-900 py-1 px-2 rounded mr-2">unlocked</label>
        <input type="radio" value="all" id="listMode3" v-model="listMode" class="hidden mr-2 peer/a3" /><label for="listMode3" class="peer-checked/a3:text-sky-500 inline-block bg-neutral-500 peer-checked/a3:bg-sky-900 py-1 px-2 rounded">all</label>
    </div>
    <div class="grid gap-2 grid-cols-1 md:grid-cols-2 xl:grid-cols-3 m-4">
        {% verbatim %}
            <div class="overflow-hidden flex flex-col justify-between bg-neutral-800 p-2 rounded" :class="{ 'opacity-60': achievement.achieved }" v-for="achievement in achievements">
                <div class="flex rounded">
                    <div :style="{ 'background-image': 'url(' + (achievement.achieved ? achievement.icon : achievement.icongray) + ')' }" class="w-12 h-12 bg-cover flex-none mr-2"></div>
                    <div>
                        <p class="text-md line-clamp-1 text-neutral-300"><span v-html="highlight(achievement.display_name)"></span></p>
                        <p class="text-sm line-clamp-1 hover:line-clamp-none text-neutral-400"><span v-html="highlight(achievement.description)"></p>
                    </div>
                </div>
                <div class="text-right text-sm text-neutral-100 mt-2" v-if="achievement.unlocked_at">{{ achievement.unlocked_at }}</div>
            </div>
        {% endverbatim %}
    </div>
</div>
<script>
    const { createApp, ref, computed } = Vue

    createApp({
        setup() {
            const listMode = ref('locked')
            const searchbox = ref('')

            const achievements = computed(() => {
                return [{{ achievements|raw }}].filter((ach) => {
                    switch (listMode.value) {
                        case 'achieved': return ach.achieved;
                        case 'locked': return !ach.achieved;
                        default: return true;
                    }
                }).filter((b) => {
                    if(searchbox.value.length === 0)
                        return true
                    let searchValue = searchbox.value.toLowerCase()
                    let achievementDisplayName = b.display_name.toLowerCase()
                    let achievementDescription = b.description ? b.description.toLowerCase() : ''
                    return achievementDisplayName.includes(searchValue) || achievementDescription.includes(searchValue)
                })
            })

            function highlight(name) {
                if(searchbox.value.length === 0)
                    return name
                return name ? name.replaceAll(new RegExp('(' + searchbox.value + ')', "ig"), '<span class="text-green-500">$1</span>') : '';
            }

            return {
                achievements, listMode, searchbox, highlight
            }
        }
    }).mount('#app')
</script>
{% endblock %}
